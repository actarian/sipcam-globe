/**
 * @license sipcam-globe v1.0.0
 * (c) 2021 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE)}(this,(function(t){"use strict";function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=.6,o=.03,r=(new THREE.Vector3(0,0,0),128),s=Math.PI/180,a=(window.COORDINATES||[{latitude:43.9096538,longitude:12.8399805,color:"283583"},{latitude:41.8519772,longitude:12.2347364,color:"00833e"},{latitude:51.5287718,longitude:-.2416791,color:"283583"},{latitude:55.6713812,longitude:12.4537393,color:"00833e"},{latitude:40.6976637,longitude:-74.1197623,color:"283583"},{latitude:19.3911668,longitude:-99.4238221,color:"00833e"},{latitude:39.9390731,longitude:116.11726,color:"283583"},{latitude:31.2243084,longitude:120.9162376,color:"00833e"}].map((function(t){return t.color=new THREE.Color("#"+t.color),t})),Math.PI),h=a/2,c=180/a,u=a/180,d=Math.atan2,l=Math.cos,p=Math.sin,g=Math.sqrt;function f(t){return(t=p(t/2))*t}function v(t,e){var n,i=t[0]*u,o=t[1]*u,r=e[0]*u,s=e[1]*u,a=l(o),v=p(o),w=l(s),m=p(s),E=a*l(i),y=a*p(i),x=w*l(r),b=w*p(r),M=2*((n=g(f(s-o)+a*w*f(r-i)))>1?h:n<-1?-h:Math.asin(n)),R=p(M),T=M?function(t){var e=p(t*=M)/R,n=p(M-t)/R,i=n*E+e*x,o=n*y+e*b,r=n*v+e*m;return[d(o,i)*c,d(r,g(i*i+o*o))*c]}:function(){return[i*c,o*c]};return T.distance=M,T}var w=function(){function e(e,n){for(var o=this.material=new t.MeshBasicMaterial({color:n.getHex()}),r=function(e){var n=e[0],o=e[1],r=e[2],s=e[3],a=E(n,o,i),h=E(r,s,i),c=(f=.75*a.distanceTo(h),w=.06,m=.6,f<=w?w:f>=m?m:f),u=v([o,n],[s,r]),d=u(.25),l=u(.75),p=E(d[1],d[0],i+c),g=E(l[1],l[0],i+c);var f,w,m;return{start:a,end:h,spline:new t.CubicBezierCurve3(a,p,g,h)}}(e).spline,s=new t.BufferGeometry,a=new Float32Array(384),h=r.getPoints(127),c=0,u=0;c<h.length;c++){var d=h[c];a[u++]=d.x,a[u++]=d.y,a[u++]=d.z}s.setAttribute("position",new t.BufferAttribute(a,3));var l=this.i=0;s.setDrawRange(0,l),this.mesh=new t.Line(s,o)}return e.prototype.onRender=function(t,e,n){var i=(t+=64*e)%256,o=0,s=0;Math.floor(t/256)%7!=0||(s=i,i>r&&(o=i-r,s=r)),this.mesh.geometry.setDrawRange(o,s)},e}(),m=function(){function e(e){var n=this.group=new t.Group,i=[],o=e.find((function(t){return t.italy}));e.filter((function(t){return!t.italy})).forEach((function(t){i.push({coords:[o.latitude,o.longitude,t.latitude,t.longitude],color:t.color})})),this.items=i,(this.curves=i.map((function(t,e){return new w(t.coords,t.color)}))).forEach((function(t){return n.add(t.mesh)})),this.i=0}return e.prototype.onRender=function(){var t=Math.floor(this.i++/5),e=this.curves.length;this.curves.forEach((function(n,i){return n.onRender(t,i,e)}))},e}();function E(e,n,i){var o=(90-e)*s,r=(n+180)*s;return new t.Vector3(-i*Math.sin(o)*Math.cos(r),i*Math.cos(o),i*Math.sin(o)*Math.sin(r))}var y=function(){function t(t,e,n,i){this.target=t||document,this.downCallback=e||function(t){console.log("DragListener.downCallback not setted",t)},this.moveCallback=n||function(t){console.log("DragListener.moveCallback not setted",t)},this.upCallback=i||function(t){console.log("DragListener.upCallback not setted",t)},this.dragging=!1,this.init()}var e=t.prototype;return e.init=function(){this.event={position:{x:0,y:0},distance:{x:0,y:0},strength:{x:0,y:0},speed:{x:0,y:0},target:this.target},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.target.addEventListener("mousedown",this.onMouseDown,!1),this.target.addEventListener("touchstart",this.onTouchStart,!1)},e.onDown=function(t,e){this.down={x:t,y:e},this.position={x:t,y:e},this.strength={x:0,y:0},this.distance=this.distance||{x:0,y:0},this.speed={x:0,y:0},this.downCallback(this)},e.onDrag=function(t,e){this.dragging=!0;var n=this.down,i=this.position,o=this.strength,r=this.speed,s=(this.target,this.distance);s.x=t-n.x,s.y=e-n.y,o.x=s.x/window.innerWidth*2,o.y=s.y/window.innerHeight*2;var a=(t-i.x)/window.innerWidth*2,h=(e-i.y)/window.innerHeight*2;r.x=.5*r.x+a,r.y=.5*r.y+h,i.x=t,i.y=e,this.strength=o;var c=this.event;c.position.x=t,c.position.y=e,c.distance.x=s.x,c.distance.y=s.y,c.strength.x=o.x,c.strength.y=o.y,c.speed.x=r.x,c.speed.y=r.y,this.moveCallback(c)},e.onUp=function(t,e){this.dragging=!1,this.upCallback(this)},e.onMouseDown=function(t){this.target.removeEventListener("touchstart",this.onTouchStart),this.onDown(t.clientX,t.clientY),this.addMouseListeners()},e.onMouseMove=function(t){this.onDrag(t.clientX,t.clientY)},e.onMouseUp=function(t){this.removeMouseListeners(),this.onDrag(t.clientX,t.clientY),this.onUp()},e.onTouchStart=function(t){this.target.removeEventListener("mousedown",this.onMouseDown),t.touches.length>0&&(t.preventDefault(),this.onDown(t.touches[0].pageX,t.touches[0].pageY),this.addTouchListeners())},e.onTouchMove=function(t){t.touches.length>0&&(t.preventDefault(),this.onDrag(t.touches[0].pageX,t.touches[0].pageY))},e.onTouchEnd=function(t){this.removeTouchListeners(),this.onDrag(this.position.x,this.position.y),this.onUp()},e.addMouseListeners=function(){document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1)},e.addTouchListeners=function(){document.addEventListener("touchend",this.onTouchEnd,!1),document.addEventListener("touchmove",this.onTouchMove,!1)},e.removeMouseListeners=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},e.removeTouchListeners=function(){document.removeEventListener("touchend",this.onTouchEnd),document.removeEventListener("touchmove",this.onTouchMove)},t}(),x=function(){function t(e){this.items=e;var n=t.getParticleCanvas(),i=new THREE.CanvasTexture(n),r=new THREE.BufferGeometry,s=new THREE.PointsMaterial({size:o,map:i,vertexColors:THREE.VertexColors,depthTest:!1,transparent:!0});s.onBeforeCompile=function(t){t.vertexShader="\n\t\t\tattribute float customsize;\n  varying float vVisible;\n  "+t.vertexShader,t.vertexShader=t.vertexShader.replace("gl_PointSize = size;","\n    vec3 vNormal = normalMatrix * normal;\n    vVisible = step( 0., dot( -normalize(mvPosition.xyz), normalize(vNormal) ) );\n\n    gl_PointSize = customsize;\n    "),t.fragmentShader="\n    varying float vVisible;\n"+t.fragmentShader,t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_fragment>","\n    if ( floor(vVisible + 0.1) == 0.0 ) discard;\n    #include <clipping_planes_fragment>\n")};var a=new Float32Array(3*e.length),h=new Float32Array(3*e.length),c=new Float32Array(3*e.length),u=new Float32Array(e.length),d=new THREE.Vector3;e.map((function(e){return t.getLatLonToVector(e.latitude,e.longitude,.601)})).forEach((function(t,n){var i=e[n];a[3*n]=t.x,a[3*n+1]=t.y,a[3*n+2]=t.z,d.copy(t).normalize(),h[3*n]=d.x,h[3*n+1]=d.y,h[3*n+2]=d.z,c[3*n]=i.color.r,c[3*n+1]=i.color.g,c[3*n+2]=i.color.b,u[n]=o}));r.setAttribute("position",new THREE.BufferAttribute(a,3)),r.setAttribute("normal",new THREE.BufferAttribute(h,3)),r.setAttribute("color",new THREE.BufferAttribute(c,3)),r.setAttribute("customsize",new THREE.Float32BufferAttribute(u,1));this.group=new THREE.Points(r,s)}return t.getParticleCanvas=function(){var t=document.createElement("canvas");t.width=64,t.height=64;var e=t.getContext("2d"),n=e.createRadialGradient(t.width/2,t.height/2,0,t.width/2,t.height/2,t.width/2);return n.addColorStop(0,"rgba(255,255,255,1)"),n.addColorStop(.9,"rgba(255,255,255,1)"),n.addColorStop(.91,"rgba(255,255,255,0)"),n.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=n,e.fillRect(0,0,t.width,t.height),t},t.getLatLonToVector=function(t,e,n){var i=(90-t)*(Math.PI/180),o=(e+180)*(Math.PI/180),r=-n*Math.sin(i)*Math.cos(o),s=n*Math.sin(i)*Math.sin(o),a=n*Math.cos(i);return new THREE.Vector3(r,a,s)},t}(),b=function(t,e){var n=document.createElement("div");n.innerHTML='\n\t\t<div class="card--address">\n\t\t\t<div class="card__content">\n\t\t\t\t<div class="card__country">'+t.country+'</div>\n\t\t\t\t<div class="card__city">Sueca</div>\n\t\t\t\t<div class="card__name">'+t.title+'</div>\n\t\t\t\t<div class="card__address">'+t.address+'</div>\n\t\t\t\t<a class="card__phone" href="tel:0034961702100">Ph. +34 96 1702100</a>\n\t\t\t\t<a class="card__email" href="mailto:www.sipcaminagra.es">www.sipcaminagra.es</a>\n\t\t\t</div>\n\t\t\t<button class="card__close"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23.954 21.03l-9.184-9.095 9.092-9.174-2.832-2.807-9.09 9.179-9.176-9.088-2.81 2.81 9.186 9.105-9.095 9.184 2.81 2.81 9.112-9.192 9.18 9.1z"/></svg></button>\n\t\t</div>',console.log(n.firstElementChild,t),this.element=n.firstElementChild,this.element.querySelector(".card__close").addEventListener("click",(function(){"function"==typeof e&&e()}))};THREE.Euler.prototype.add=function(t){return this.set(this.x+t.x,this.y+t.y,this.z+t.z,this.order),this};var M="interactive",R="curves";(function(){function t(t){n(this,"point",{pow:1}),n(this,"pointIndex_",-1),this.element=t,this.load()}t.init=function(){return Array.prototype.slice.call(document.querySelectorAll(".group--globe")).map((function(e){return new t(e)}))};var r,s,a,h=t.prototype;return h.load=function(){var t=this,e=this.element.getAttribute("data-src");fetch(e).then((function(t){return t.json()})).then((function(e){var n=(e=e.map((function(t){return t.latitude=t.position.lat,t.longitude=t.position.lng,t.color="company"===t.type?new THREE.Color("#00833e"):new THREE.Color("#283583"),t}))).find((function(t){return t.italy})),i=e.filter((function(t){return!t.italy}));t.data=[n].concat(i),t.loadTexture()}))},h.loadTexture=function(){var t=this,e=this.element.getAttribute("data-texture"),n=new THREE.TextureLoader;n.crossOrigin="",n.load(e,(function(e){t.globeTexture=e,t.initScene()}))},h.initScene=function(){var t=this.element,e=this.mode=t.getAttribute("data-mode")===M?M:R;this.mouse={x:0,y:0},this.parallax={x:0,y:0};var n=this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0});n.shadowMap.enabled=!0,n.setSize(window.innerWidth,window.innerHeight),t.appendChild(n.domElement);var i=this.scene=new THREE.Scene,o=this.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.01,100);o.position.set(0,1,2),o.up=new THREE.Vector3(0,0,-1),o.lookAt(new THREE.Vector3(0,0,0));var r=this.ambient=new THREE.AmbientLight(10065558);i.add(r);var s=this.directional1=new THREE.DirectionalLight(16776187,.5);s.position.set(0,1.5,1),i.add(s);new THREE.Vector3(0,0,1);var a=this.globeRotation=new THREE.Euler(0,1.2*Math.PI,0,"XYZ"),h=this.globeDragRotation=new THREE.Euler(0,0,0,"XYZ"),c=this.globeStartDragRotation=new THREE.Euler(0,0,0,"XYZ"),u=this.globeSpeedRotation=new THREE.Euler(0,0,0,"XYZ"),d=this.globeGroup=new THREE.Group;d.rotation.set(a.x,a.y,a.z),i.add(d);var l=this.globe=this.getGlobe(this.globeTexture);d.add(l);var p=this.points=new x(this.data);if(d.add(p.group),e===R){var g=this.curves=new m(this.data);d.add(g.group)}(this.raycaster=new THREE.Raycaster).params.Points.threshold=.015;this.pointer=new THREE.Vector2;this.onResize=this.onResize.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),window.addEventListener("resize",this.onResize,!1),document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp);this.dragService=new y(t,(function(t){c.copy(h)}),(function(t){h.copy(c).add(new THREE.Euler(Math.PI*t.strength.y*.5,Math.PI*t.strength.x,0,"XYZ")),u.set(0,0,0,"XYZ")}),(function(t){u.set(Math.PI*t.speed.y*.5,Math.PI*t.speed.x,0,"XYZ")}));this.onPlay(),this.onResize(),this.element.classList.add("init")},h.getGlobe=function(t){var e=new THREE.SphereGeometry(i,48,48),n=new THREE.MeshStandardMaterial({color:"#ffffff",roughness:1,metalness:0,map:t});return new THREE.Mesh(e,n)},h.addShadow=function(t){var e=new THREE.PlaneGeometry(100,100);e.rotateX(-Math.PI/4);var n=new THREE.ShadowMaterial;n.opacity=.2;var i=new THREE.Mesh(e,n);return i.position.z=-.6,i.receiveShadow=!0,t.add(i),i},h.onResize=function(){var t=this.element,e=this.renderer,n=this.camera,i={width:0,height:0,aspect:0};i.width=t.offsetWidth,i.height=t.offsetHeight,i.aspect=i.width/i.height,e&&e.setSize(i.width,i.height),n&&(n.aspect=i.aspect,n.zoom=window.innerWidth<768?1.3:1,n.updateProjectionMatrix())},h.onPointerMove=function(t){var e=this.element.getBoundingClientRect(),n=t.clientX-e.x,i=t.clientY-e.y,o=e.width,r=e.height;this.pointer.x=n/o*2-1,this.pointer.y=-i/r*2+1},h.onPointerUp=function(t){var e=this.element.getBoundingClientRect(),n=t.clientX-e.x,i=t.clientY-e.y,o=e.width,r=e.height;this.pointer.x=n/o*2-1,this.pointer.y=-i/r*2+1,this.pointerUp=!0},h.onMouseMove=function(t){var e=window.innerWidth/2,n=window.innerHeight/2;this.mouse={x:(t.clientX-e)/e,y:(t.clientY-n)/n}},h.doParallax=function(){this.parallax.x+=(this.mouse.x-this.parallax.x)/8,this.parallax.y+=(this.mouse.y-this.parallax.y)/8,this.directional1.position.set(.3*this.parallax.x,2+.3*this.parallax.y,.5),this.directional2.position.set(.3*this.parallax.x,.3*this.parallax.y-2,0)},h.onRender=function(t){null==this.tooltip&&(this.dragService.dragging||(this.globeRotation.x+=this.globeSpeedRotation.x,this.globeRotation.y+=this.globeSpeedRotation.y,this.globeSpeedRotation.x+=(0-this.globeSpeedRotation.x)/50,this.globeSpeedRotation.y+=(3e-4-this.globeSpeedRotation.y)/50),this.globeGroup.rotation.copy(this.globeRotation).add(this.globeDragRotation),this.mode===R&&this.curves.onRender(),this.onCheckIntersections()),this.renderer.render(this.scene,this.camera)},h.onPlay=function(){var t=this,e=new THREE.Clock;!function n(i){var o=e.getDelta();t.onRender(o),window.requestAnimationFrame(n)}()},h.onCheckIntersections=function(){if(this.mode===M){var t=this.points.group,e=(t.geometry.attributes,this.raycaster),n=this.pointer,i=this.camera;e.setFromCamera(n,i);var o=e.intersectObject(t),r=o.length>0?o[0]:null;this.pointIndex=r?r.index:-1}},h.onPointSelected=function(t){var e=this;if(-1!==t){var n=this.data[t],i=this.tooltip=new b(n,(function(){e.element.removeChild(i.element),e.tooltip=null}));this.element.appendChild(i.element),console.log("onPointSelected",t,this.tooltip),"function"==typeof window.onPointSelected&&window.onPointSelected(n,t)}},r=t,(s=[{key:"pointIndex",set:function(t){if(this.pointIndex_!==t){this.pointIndex_=t;var e=this.points.group.geometry.attributes;gsap.set(this.element,{cursor:-1!==t?"pointer":"auto"});var n=this.point;n.pow=0,gsap.to(n,{pow:1,duration:.6,ease:Power3.easeOut,overwrite:"all",onUpdate:function(){for(var i=0,r=e.customsize.array.length;i<r;i++)i===t?e.customsize.array[i]=o*(1+1*n.pow):e.customsize.array[i]>o&&(e.customsize.array[i]=o);e.customsize.needsUpdate=!0}})}this.pointerUp&&(this.pointerUp=!1,this.onPointSelected(t))}}])&&e(r.prototype,s),a&&e(r,a),t})().init()}));
//# sourceMappingURL=main.min.js.map